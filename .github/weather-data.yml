name: Run Weather Script and Push Changes

on:
  schedule:
    # Executa diariamente às 10:00 AM UTC
    - cron: '0 10 * * *' # min hour day month year
  workflow_dispatch:  # Permite execução manual

permissions:
  contents: write  # Permite fazer push de mudanças no repositório

jobs:
  run-weather:
    runs-on: ubuntu-latest

    steps:
    # Etapa 1: Fazer checkout do repositório
    - name: Checkout repository
      uses: actions/checkout@v3
      with:
        persist-credentials: true  # Mantém as credenciais para permitir o push de alterações

    # Etapa 2: Configurar o ambiente Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'  # Defina a versão do Python necessária

    # Etapa 3: Instalar dependências
    - name: Install dependencies
      run: pip install -r requirements.txt

    # Etapa 4: Executar o script `weather.py`
    - name: Run weather.py script
      run: python weather.py  # Aqui você executa o `weather.py` ao invés de `stocks.py`

    # Etapa 5: Commit e push das mudanças de volta ao repositório
    - name: Commit and push changes
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}  # Token do GitHub para autenticação
      run: |
        # Configura o nome de usuário e e-mail do commit
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        
        # Adiciona e comita as mudanças
        git add .
        git commit -m "Automated changes by weather.py script" || echo "No changes to commit"
        
        # Push das mudanças para o repositório
        git push origin main
